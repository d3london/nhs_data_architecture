<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Summary of Data Sources – NHS Data Architecture &amp; Data Flows</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">NHS Data Architecture &amp; Data Flows</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../national/main.html">NATIONAL</a></li><li class="breadcrumb-item"><a href="../national/sources.html">Data Sources</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">OVERVIEW</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">NATIONAL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../national/main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">National Schematic</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../national/sources.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data Sources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../national/flows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Flows</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#patient-administration" id="toc-patient-administration" class="nav-link active" data-scroll-target="#patient-administration">Patient administration</a></li>
  <li><a href="#primary-care" id="toc-primary-care" class="nav-link" data-scroll-target="#primary-care">Primary care</a></li>
  <li><a href="#secondary-tertiary-care" id="toc-secondary-tertiary-care" class="nav-link" data-scroll-target="#secondary-tertiary-care">Secondary / tertiary care</a></li>
  <li><a href="#specialist-testing" id="toc-specialist-testing" class="nav-link" data-scroll-target="#specialist-testing">Specialist testing</a></li>
  <li><a href="#version-history" id="toc-version-history" class="nav-link" data-scroll-target="#version-history">Version history</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../national/main.html">NATIONAL</a></li><li class="breadcrumb-item"><a href="../national/sources.html">Data Sources</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Summary of Data Sources</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Early preview v0.1</em></p>
<p>This page contains an overview of different types of software systems, or modules within systems, where a patient may have data generated and recorded across their healthcare journey. These are not descriptions of specific software, but rather a <strong>general classification based on the different types of data that are generated.</strong></p>
<section id="patient-administration" class="level3">
<h3 class="anchored" data-anchor-id="patient-administration">Patient administration</h3>
<section id="patient-administration-systems-pas" class="level4">
<h4 class="anchored" data-anchor-id="patient-administration-systems-pas">Patient administration systems (PAS)</h4>
<p><img src="../diagrams/sources/source_pas.png" title="" height="70"></p>
<p>Software that capture non-clinical information about patients, and their activity across different care settings (including all hospitals). Information captured includes identities, demographics, and address, and also captures pathway information such as referrals, waiting lists and appointments, as well as inpatient activity and ward movements or discharge. PAS may be standalone software solutions offered by different suppliers, or may be integrated as a function into Electronic Health Records (EHR) software. PAS also serves as a master patient index for other records in the care location. PAS are joined directly to the national <a href="https://digital.nhs.uk/services/personal-demographics-service">Personal Demographics Service</a>, which is a live, national directory of non-clinical information for patients that is part of the NHS Spine.</p>
</section>
</section>
<section id="primary-care" class="level3">
<h3 class="anchored" data-anchor-id="primary-care">Primary care</h3>
<section id="gp-software-demographic-record" class="level4">
<h4 class="anchored" data-anchor-id="gp-software-demographic-record">GP software demographic record</h4>
<p><img src="../diagrams/sources/source_gp_demog.png" title="" height="70"></p>
<p>Much like PAS systems, these are parts of a GP Electronic Health Record (EHR) software that maintain a record of non-clinical information for patients, including their GP registration history. Patient details across different GP systems are coordinated through a <a href="https://digital.nhs.uk/services/primary-care-registration-management">Primary Care Registration Management service</a> and also synced with the <a href="https://digital.nhs.uk/services/personal-demographics-service">Personal Demographics Service</a>. Data may be accessible to analysts via data tables containing patient identifiers, demographic, address, and registration information.</p>
</section>
<section id="gp-software-coded-clinical-record" class="level4">
<h4 class="anchored" data-anchor-id="gp-software-coded-clinical-record">GP software coded clinical record</h4>
<p><img src="../diagrams/sources/source_gp_codes.png" title="" height="70"></p>
<p>When patients see a clinician, or undergo procedures and tests, or experience medical diagnoses, symptoms, and events, these data are entered into the record as ‘clinical codes’. Coding is performed manually, largely by GPs during or following consultations, or after reviewing letters and results. There are hundreds of thousands of codes that represent unique clinical concepts, and large vocabularies or dictionaries that define these. The most commonly used for primary care in the NHS is <a href="https://www.england.nhs.uk/digitaltechnology/digital-primary-care/snomed-ct/">SNOMED CT</a>. Codes are typically stored in data tables. A simple example of part of such a table is below:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 55%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>PATIENT_ID</th>
<th>DATE</th>
<th>CONCEPT_NAME</th>
<th>CONCEPT_CODE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>123456789</td>
<td>2020-1-1</td>
<td>Pre-diabetes (disorder)</td>
<td>858301000000107</td>
</tr>
<tr class="even">
<td>123456789</td>
<td>2021-1-1</td>
<td>Diabetes mellitus type 2 (disorder)</td>
<td>44054006</td>
</tr>
<tr class="odd">
<td>123456789</td>
<td>2024-1-1</td>
<td>Retinopathy due to diabetes mellitus (disorder)</td>
<td>4855003</td>
</tr>
</tbody>
</table>
</section>
<section id="gp-software-medication-prescriptions" class="level4">
<h4 class="anchored" data-anchor-id="gp-software-medication-prescriptions">GP software medication prescriptions</h4>
<p><img src="../diagrams/sources/source_gp_meds.png" title="" height="70"></p>
<p>When a prescription for a medication is generated, either one off or as a repeat prescription, this information is recorded in the GP EHR. This information is used to <a href="https://digital.nhs.uk/services/electronic-prescription-service">send prescriptions</a> to a dispenser (like a local pharmacy), as well as populate the patient’s <a href="https://digital.nhs.uk/services/summary-care-records-scr">Summary Care Record</a> with their current medications. The GP EHR also contains records of requests - such as when a patient asks for a prescription to be renewed.</p>
</section>
<section id="gp-software-laboratory-test-results" class="level4">
<h4 class="anchored" data-anchor-id="gp-software-laboratory-test-results">GP software laboratory test results</h4>
<p><img src="../diagrams/sources/source_gp_labs.png" title="" height="70"></p>
<p>Results from tests and other measurements can be entered into the record by clinicians, and are usually stored as separate tables that also capture result values and outcomes. In many cases, where tests originated in primary care and where there is interoperability between pathology services and the EHR, these values are automatically sent into the system once results are ready.</p>
</section>
<section id="gp-software-free-text-clinical-record" class="level4">
<h4 class="anchored" data-anchor-id="gp-software-free-text-clinical-record">GP software free text clinical record</h4>
<p><img src="../diagrams/sources/source_gp_text.png" title="" height="70"></p>
<p>While GPs make effort to code important information about their patients, a large amount of additional information is found in the unstructured, or free text, record. This simply includes blocks of text that are written to describe encounters and other interactions. As part of the medicolegal record, such text typically contains patients’ descriptions of their medical history, symptoms, and other experiences, as well as examination findings and clinical thought processes. Free text data is not readily accessible for analysis, and may also contain idenfitiable information.</p>
</section>
<section id="community-pharmacy-dispensing" class="level4">
<h4 class="anchored" data-anchor-id="community-pharmacy-dispensing">Community pharmacy dispensing</h4>
<p><img src="../diagrams/sources/source_pharmacy.png" title="" height="70"></p>
<p>Most prescriptions are dispensed to patients through designated local pharmacies. <a href="https://digital.nhs.uk/services/electronic-prescription-service">While the electronic prescription service</a> produces an electronic record of prescribed items that can be used for reimbursements, some prescription and dispensing activity are still conducted through paper based records.</p>
</section>
</section>
<section id="secondary-tertiary-care" class="level3">
<h3 class="anchored" data-anchor-id="secondary-tertiary-care">Secondary / tertiary care</h3>
<section id="hospital-ehr-coded-clinical-record" class="level4">
<h4 class="anchored" data-anchor-id="hospital-ehr-coded-clinical-record">Hospital EHR coded clinical record</h4>
<p><img src="../diagrams/sources/source_hosp_codes.png" title="" height="70"></p>
<p>Data that is coded at point of care is less common in secondary care when compared to primary care, but some Electronic Health Record (EHR) systems such as Epic enable the entry of standard codes such as SNOMED CT into a patient’s record. More commonly, data may be “semi-structured” through forms or flowsheets, where records are made with specific fields (such as “medical history”, “recorded symptoms”, and “examination findings”).</p>
</section>
<section id="hospital-ehr-free-text-clinical-record" class="level4">
<h4 class="anchored" data-anchor-id="hospital-ehr-free-text-clinical-record">Hospital EHR free text clinical record</h4>
<p><img src="../diagrams/sources/source_hosp_text.png" title="" height="70"></p>
<p>The vast majority of patient data in secondary care is found as free text. This includes narrative that records the details of encounters between clinicians and patients (from admission to ward rounds and discharge), as well as records of procedures and operations, nursing and allied health professional notes, and clinical thought processes (for example from a cancer multi-disciplinary meeting). This also includes discharge summaries, clinical letters, and reports of investigations such as radiology imaging or pathology. These type of data may be in different electronic formats, such as MS Word and pdf files, and often contain valuable information that is not found in the structured record. The traditional way of making this type of data analysable, is through health professionals or clinical coders manually collecting relevant data items, and inputting them into a table. Some of this process is being automated by language artificial intelligence (AI) platforms.</p>
</section>
<section id="hospital-ehr-lab-test-results" class="level4">
<h4 class="anchored" data-anchor-id="hospital-ehr-lab-test-results">Hospital EHR lab test results</h4>
<p><img src="../diagrams/sources/source_hosp_labs.png" title="" height="70"></p>
<p>In secondary care settings, laboratory test results and other clinical measurements are also captured in data tables. Laboratory results are often managed through dedicated Laboratory Information Management Systems (LIMS) which are part of, or interface with, the main hospital EHR. Data can be used during care for automated alerting of abnormal results, and for viewing trends.</p>
</section>
<section id="hospital-patient-observations" class="level4">
<h4 class="anchored" data-anchor-id="hospital-patient-observations">Hospital patient observations</h4>
<p><img src="../diagrams/sources/source_hosp_monitors.png" title="" height="70"></p>
<p>A rich source of information found only in hospital data, are the frequent physiological measurements that are taken of patients. These may range from measures such as height and weight, to blood pressures, heart rates, temperatures, to real-time recording of vital signs using bedside monitoring. The data may be generated and held in different kinds of system, but most hospital EHRs will allow results to be captured into data tables. In hospitals with intensive care units that have EHR, monitors may output directly into data tables and record detailed trends of vital signs.</p>
</section>
<section id="hospital-ehr-medications-chart-pharmacy-systems" class="level4">
<h4 class="anchored" data-anchor-id="hospital-ehr-medications-chart-pharmacy-systems">Hospital EHR medications chart / pharmacy systems</h4>
<p><img src="../diagrams/sources/source_hosp_meds.png" title="" height="70"> <img src="../diagrams/sources/source_hosp_dispense.png" title="" height="70"></p>
<p>Hospital pharmacies use electronic systems to manage general medication orders and dispensing, for both inpatient and outpatient care. For inpatients, electronic medication charts are used by clinicians for viewing and recording prescriptions, timings, and administration, often through Electronic Prescription and Medications Administration (EPMA) systems. The data underlying these systems can be used to show what medications and dosages were prescribed, dispensed, and administered. These systems are often part of or interfaced with the main EHR. They may also integrate decision support features for drug interactions and dosing.</p>
</section>
<section id="hospital-ehr-chemotherapy-chart" class="level4">
<h4 class="anchored" data-anchor-id="hospital-ehr-chemotherapy-chart">Hospital EHR chemotherapy chart</h4>
<p><img src="../diagrams/sources/source_hosp_chemo.png" title="" height="70"></p>
<p>While most medications are prescribed and administered in the general record, specialised chemotherapy systems are often used to administer cytotoxic agents, in both inpatient and outpatient/‘day case’ settings.</p>
</section>
<section id="hospital-radiology-dicom-results" class="level4">
<h4 class="anchored" data-anchor-id="hospital-radiology-dicom-results">Hospital&nbsp;Radiology / DICOM results</h4>
<p><img src="../diagrams/sources/source_hosp_dicom.png" title="" height="70"></p>
<p>Radiology departments use Picture Archiving and Communication Systems (PACS) to store and manage medical imaging studies. These systems store images in the DICOM (Digital Imaging and Communications in Medicine) format, along with associated metadata. Radiologists’ reports are typically stored as free text in a Radiology Information System (RIS), which is often integrated with the PACS and the main hospital EHR. DICOM files are typically extremely large. The ability to extract and use DICOMs for analysis relies heavily on being able to access high quality metadata, which can be used to identify and access images of interest.</p>
</section>
<section id="medical-device-outputs" class="level4">
<h4 class="anchored" data-anchor-id="medical-device-outputs">Medical device outputs</h4>
<p><img src="../diagrams/sources/source_hosp_device.png" title="" height="70"></p>
<p>Numnerous types of modern medical device, ranging from electrocardiogram machines, to ventilators and infusion pumps, have the capability to output data directly into information systems. Some signals data may be stored in time-series databases (for example - infusion rate every hour). Other device outputs may be stored as scanned images. Many devices do <em>not</em> interface with EHR, or do not have a way to extract data in an analysable form.</p>
</section>
<section id="histopathology-results-and-reports" class="level4">
<h4 class="anchored" data-anchor-id="histopathology-results-and-reports">Histopathology results and reports</h4>
<p><img src="../diagrams/sources/source_hosp_histopath.png" title="" height="70"></p>
<p>Digital pathology systems are increasingly used to capture, store, and analyze high-resolution images of histopathology slides. These systems allow for remote viewing, automated image analysis, and integration with other clinical data sources. The associated pathology reports are often stored as free text within the Laboratory Information System.</p>
</section>
<section id="genomic-testing-reports" class="level4">
<h4 class="anchored" data-anchor-id="genomic-testing-reports">Genomic testing reports</h4>
<p><img src="../diagrams/sources/source_hosp_genomics.png" title="" height="70"></p>
<p>While raw sequencing data is generated in genomics testing labs, these data are not typically available for analysis or clinical use. Instead, reports of gene panels, or reports of specific genetic mutations or biomarkers, are passed to hospitals and stored as free text files (e.g.&nbsp;in .pdf format).</p>
</section>
</section>
<section id="specialist-testing" class="level3">
<h3 class="anchored" data-anchor-id="specialist-testing">Specialist testing</h3>
<p><img src="../diagrams/sources/source_molecular_labs.png" title="" height="70"></p>
<section id="moleculargenomic-laboratory-network-systems" class="level4">
<h4 class="anchored" data-anchor-id="moleculargenomic-laboratory-network-systems">Molecular/genomic laboratory network systems</h4>
<p>Genomic testing in the NHS is provided through a national testing network. Specifically, the testing for mutations within tumours (somatic molecular testing) is handled by a network of molecular diagnostic laboratories. The direct results from these tests (e.g.&nbsp;sequencing data) are held locally and not directly available for research or analysis use-cases. However, data are passed back to hospitals as reports.</p>
</section>
</section>
<section id="version-history" class="level3">
<h3 class="anchored" data-anchor-id="version-history">Version history</h3>
<p><em>version 0.1 24-08-01: first version of key sources</em></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/d3london\.github\.io\/nhs_data_architecture\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>